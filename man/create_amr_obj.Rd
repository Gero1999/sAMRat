% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/create_amr_obj.R
\name{create_amr_obj}
\alias{create_amr_obj}
\title{Create an AMR-ready object by converting selected columns}
\usage{
create_amr_obj(
  df,
  mo_col = NULL,
  sir_cols = NULL,
  mic_cols = NULL,
  disk_cols = NULL,
  date_col = NULL,
  subject_col = NULL,
  filter_first_isolate = FALSE
)

create_amr_obj(
  df,
  mo_col = NULL,
  sir_cols = NULL,
  mic_cols = NULL,
  disk_cols = NULL,
  date_col = NULL,
  subject_col = NULL,
  filter_first_isolate = FALSE
)
}
\arguments{
\item{df}{A data.frame containing the raw isolate or susceptibility
data.}

\item{mo_col}{Character (single) name of the microorganism column in
`df`. If provided, values are coerced with `as.mo()` and
microorganism metadata is returned.}

\item{sir_cols}{Character vector of column names containing S/I/R
results. Each found column will be coerced with `as.sir()`.}

\item{mic_cols}{Character vector of column names containing MIC
results. Each found column will be coerced with `as.mic()`.}

\item{disk_cols}{Character vector of column names containing disk
diffusion results. Each found column will be coerced with
`as.disk()`.}

\item{date_col}{Character (single) name of a date column. The function
will try a few common formats and coerce the column to `Date`.}

\item{subject_col}{Character (single) name of the column used as
subject/patient identifier. If provided a `SUBJID` factor column is
added to the returned data.}

\item{filter_first_isolate}{Logical, if `TRUE` the data is filtered to
only the first isolate per subject x microorganism (earliest date).
The function uses `dplyr::filter()` with an internal helper and will
fall back to returning the unfiltered data on error.}
}
\value{
A named list with at least:
  * `data`: the transformed `data.frame`.
  * `mo` (optional): list with `naming`, `traits`, `taxonomy`, and
    `details` data.frames for the microorganism column.
  * `ab` (optional): list with `group`, `details`, `atc`, `tradenames`
    and `loinc` information for antibiotic columns.

A named list with at least:
  * `data`: the transformed `data.frame`.
  * `mo` (optional): list with `naming`, `traits`, `taxonomy`, and
    `details` data.frames for the microorganism column.
  * `ab` (optional): list with `group`, `details`, `atc`, `tradenames`
    and `loinc` information for antibiotic columns.
}
\description{
This helper converts specified columns in a data.frame to AMR-friendly
types using the [AMR] package (for example `as.mo()`, `as.sir()`,
`as.mic()`, `as.disk()`) and collects metadata for microorganisms and
antimicrobials. It will also attempt to coerce a date column to `Date`
using common formats and can optionally filter to the first isolate per
subject and microorganism.

This helper converts specified columns in a data.frame to AMR-friendly
types using the [AMR] package (for example `as.mo()`, `as.sir()`,
`as.mic()`, `as.disk()`) and collects metadata for microorganisms and
antimicrobials. It will also attempt to coerce a date column to `Date`
using common formats and can optionally filter to the first isolate per
subject and microorganism.
}
\details{
The returned object is a list with at least a `data` element (the
transformed data.frame). When a microorganism column is provided, a
`mo` sub-list with naming, traits, taxonomy and details is included.
When antibiotic columns are provided a corresponding `ab` sub-list is
returned with group and details information.

This function wraps a number of convenience conversions from
  the [AMR] package. It uses `try()`/`tryCatch()` in several places to
  avoid hard failures for partial or unexpected inputs.

The returned object is a list with at least a `data` element (the
transformed data.frame). When a microorganism column is provided, a
`mo` sub-list with naming, traits, taxonomy and details is included.
When antibiotic columns are provided a corresponding `ab` sub-list is
returned with group and details information.

This function wraps a number of convenience conversions from
  the [AMR] package. It uses `try()`/`tryCatch()` in several places to
  avoid hard failures for partial or unexpected inputs.
}
\examples{

# Minimal example (requires the AMR package):
if (requireNamespace("AMR", quietly = TRUE)) {
  df <- data.frame(
    mo = c("Escherichia coli", "Staphylococcus aureus"),
    AMP = c("R", "S"),
    date = c("2020-01-01", "2020-01-02"),
    id = c("p1", "p2"),
    stringsAsFactors = FALSE
  )
  create_amr_obj(df, mo_col = "mo", sir_cols = "AMP", date_col = "date", subject_col = "id")
}


# Minimal example (requires the AMR package):
if (requireNamespace("AMR", quietly = TRUE)) {
  df <- data.frame(
    mo = c("Escherichia coli", "Staphylococcus aureus"),
    AMP = c("R", "S"),
    date = c("2020-01-01", "2020-01-02"),
    id = c("p1", "p2"),
    stringsAsFactors = FALSE
  )
  create_amr_obj(df, mo_col = "mo", sir_cols = "AMP", date_col = "date", subject_col = "id")
}

}
\seealso{
[as.mo()], [as.sir()], [as.mic()], [as.disk()]

[as.mo()], [as.sir()], [as.mic()], [as.disk()]
}
